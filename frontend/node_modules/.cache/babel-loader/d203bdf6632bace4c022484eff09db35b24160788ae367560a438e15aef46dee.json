{"ast":null,"code":"// Token cleanup utility to handle invalid tokens\nexport const clearAuthData = () => {\n  localStorage.removeItem('token');\n  localStorage.removeItem('user');\n  console.log('üßπ Auth data cleared');\n};\nexport const isTokenValid = async () => {\n  const token = localStorage.getItem('token');\n  if (!token) return false;\n\n  // Basic token format validation\n  const parts = token.split('.');\n  if (parts.length !== 3) {\n    console.log('‚ö†Ô∏è Token format invalid, clearing...');\n    clearAuthData();\n    return false;\n  }\n  try {\n    // Test token with a simple API call\n    const response = await fetch('http://localhost:5002/api/tests/health', {\n      headers: {\n        'Authorization': `Bearer ${token}`\n      }\n    });\n    if (response.status === 401) {\n      console.log('‚ö†Ô∏è Token invalid (401), clearing...');\n      clearAuthData();\n      return false;\n    }\n    return response.ok;\n  } catch (error) {\n    console.error('Token validation error:', error);\n    clearAuthData();\n    return false;\n  }\n};\nexport const refreshAuthState = () => {\n  // Force a page reload to refresh auth context\n  window.location.reload();\n};\n\n// Auto-clear invalid tokens on app startup\nexport const validateTokenOnStartup = async () => {\n  const token = localStorage.getItem('token');\n  if (token) {\n    const parts = token.split('.');\n    if (parts.length !== 3) {\n      console.log('‚ö†Ô∏è Invalid token format detected on startup, clearing...');\n      clearAuthData();\n      alert('Your login session is invalid. Please login again.');\n      if (window.location.pathname !== '/login' && window.location.pathname !== '/') {\n        window.location.href = '/login';\n      }\n    }\n  }\n};","map":{"version":3,"names":["clearAuthData","localStorage","removeItem","console","log","isTokenValid","token","getItem","parts","split","length","response","fetch","headers","status","ok","error","refreshAuthState","window","location","reload","validateTokenOnStartup","alert","pathname","href"],"sources":["E:/STC/frontend/src/utils/tokenCleanup.js"],"sourcesContent":["// Token cleanup utility to handle invalid tokens\r\nexport const clearAuthData = () => {\r\n  localStorage.removeItem('token');\r\n  localStorage.removeItem('user');\r\n  console.log('üßπ Auth data cleared');\r\n};\r\n\r\nexport const isTokenValid = async () => {\r\n  const token = localStorage.getItem('token');\r\n  if (!token) return false;\r\n  \r\n  // Basic token format validation\r\n  const parts = token.split('.');\r\n  if (parts.length !== 3) {\r\n    console.log('‚ö†Ô∏è Token format invalid, clearing...');\r\n    clearAuthData();\r\n    return false;\r\n  }\r\n  \r\n  try {\r\n    // Test token with a simple API call\r\n    const response = await fetch('http://localhost:5002/api/tests/health', {\r\n      headers: {\r\n        'Authorization': `Bearer ${token}`\r\n      }\r\n    });\r\n    \r\n    if (response.status === 401) {\r\n      console.log('‚ö†Ô∏è Token invalid (401), clearing...');\r\n      clearAuthData();\r\n      return false;\r\n    }\r\n    \r\n    return response.ok;\r\n  } catch (error) {\r\n    console.error('Token validation error:', error);\r\n    clearAuthData();\r\n    return false;\r\n  }\r\n};\r\n\r\nexport const refreshAuthState = () => {\r\n  // Force a page reload to refresh auth context\r\n  window.location.reload();\r\n};\r\n\r\n// Auto-clear invalid tokens on app startup\r\nexport const validateTokenOnStartup = async () => {\r\n  const token = localStorage.getItem('token');\r\n  if (token) {\r\n    const parts = token.split('.');\r\n    if (parts.length !== 3) {\r\n      console.log('‚ö†Ô∏è Invalid token format detected on startup, clearing...');\r\n      clearAuthData();\r\n      alert('Your login session is invalid. Please login again.');\r\n      if (window.location.pathname !== '/login' && window.location.pathname !== '/') {\r\n        window.location.href = '/login';\r\n      }\r\n    }\r\n  }\r\n};"],"mappings":"AAAA;AACA,OAAO,MAAMA,aAAa,GAAGA,CAAA,KAAM;EACjCC,YAAY,CAACC,UAAU,CAAC,OAAO,CAAC;EAChCD,YAAY,CAACC,UAAU,CAAC,MAAM,CAAC;EAC/BC,OAAO,CAACC,GAAG,CAAC,sBAAsB,CAAC;AACrC,CAAC;AAED,OAAO,MAAMC,YAAY,GAAG,MAAAA,CAAA,KAAY;EACtC,MAAMC,KAAK,GAAGL,YAAY,CAACM,OAAO,CAAC,OAAO,CAAC;EAC3C,IAAI,CAACD,KAAK,EAAE,OAAO,KAAK;;EAExB;EACA,MAAME,KAAK,GAAGF,KAAK,CAACG,KAAK,CAAC,GAAG,CAAC;EAC9B,IAAID,KAAK,CAACE,MAAM,KAAK,CAAC,EAAE;IACtBP,OAAO,CAACC,GAAG,CAAC,sCAAsC,CAAC;IACnDJ,aAAa,CAAC,CAAC;IACf,OAAO,KAAK;EACd;EAEA,IAAI;IACF;IACA,MAAMW,QAAQ,GAAG,MAAMC,KAAK,CAAC,wCAAwC,EAAE;MACrEC,OAAO,EAAE;QACP,eAAe,EAAE,UAAUP,KAAK;MAClC;IACF,CAAC,CAAC;IAEF,IAAIK,QAAQ,CAACG,MAAM,KAAK,GAAG,EAAE;MAC3BX,OAAO,CAACC,GAAG,CAAC,qCAAqC,CAAC;MAClDJ,aAAa,CAAC,CAAC;MACf,OAAO,KAAK;IACd;IAEA,OAAOW,QAAQ,CAACI,EAAE;EACpB,CAAC,CAAC,OAAOC,KAAK,EAAE;IACdb,OAAO,CAACa,KAAK,CAAC,yBAAyB,EAAEA,KAAK,CAAC;IAC/ChB,aAAa,CAAC,CAAC;IACf,OAAO,KAAK;EACd;AACF,CAAC;AAED,OAAO,MAAMiB,gBAAgB,GAAGA,CAAA,KAAM;EACpC;EACAC,MAAM,CAACC,QAAQ,CAACC,MAAM,CAAC,CAAC;AAC1B,CAAC;;AAED;AACA,OAAO,MAAMC,sBAAsB,GAAG,MAAAA,CAAA,KAAY;EAChD,MAAMf,KAAK,GAAGL,YAAY,CAACM,OAAO,CAAC,OAAO,CAAC;EAC3C,IAAID,KAAK,EAAE;IACT,MAAME,KAAK,GAAGF,KAAK,CAACG,KAAK,CAAC,GAAG,CAAC;IAC9B,IAAID,KAAK,CAACE,MAAM,KAAK,CAAC,EAAE;MACtBP,OAAO,CAACC,GAAG,CAAC,0DAA0D,CAAC;MACvEJ,aAAa,CAAC,CAAC;MACfsB,KAAK,CAAC,oDAAoD,CAAC;MAC3D,IAAIJ,MAAM,CAACC,QAAQ,CAACI,QAAQ,KAAK,QAAQ,IAAIL,MAAM,CAACC,QAAQ,CAACI,QAAQ,KAAK,GAAG,EAAE;QAC7EL,MAAM,CAACC,QAAQ,CAACK,IAAI,GAAG,QAAQ;MACjC;IACF;EACF;AACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}